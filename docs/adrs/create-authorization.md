
# Авторизация.Начало.

## Status
---
Предложение

## Context
---
Необходимо реализовать сервис-фасад и сервис авторизации.

## Decision
### Шаблоны микросервисов
---
Для создания авторизационного сервис используем шаблон Calabonga.Microservice.IdentityModule.  
Для создания сервис-фасада используем шаблон Calabonga.Microservice.Module.  
Шаблоны используются для общей схемы всех микросервисов проекта.  
[Identity и простой шаблоны](https://github.com/Calabonga/Microservice-Template/tree/master/AspNetCore%20v6.0/MinimalAPI)

### Фасад-сервис
---
Методы фасад-сервиса, за исключением методов авторизации, являются закрытыми для неавторизованных пользователей.

### Messaging
---
Сервис-фасад (producer) отправляет сообщение {логин и пароль} в Kafka в топик "auth".  
Микросервис авторизации (consumer) получает сообщение и проверяет наличие пользователя,
если пользователь существует, то генерируется токен и отправляется сообщение в кафку {токен},
иначе отправляется {токен=empty}. 
Сервис-фасад получает данные из Kafka и возращает ответ {OperationResult} клиенту.

#### Метод 1. HTTP + OpenIddict
---
Авторизация пользователя через метод API с http-запросом на авторизационный сервис (OpenIddict). OpenIddict по-умолчанию реализован в template'е
что упрощает первичную разработку и дает более эффективную возможность добавления новых методов авторизации (смена пароля и т.п.). Помимо этого при использовании
OpenIddict'а уже имеется встроенный service-to-service communication, что в дальнейшем будет полезно при авторизации сервисов.


#### Метод 2. Grpc + OpenIddict
---
Метод схож с методом 1, но данные будут обрабатываться grpc-сервисами.



#### Метод 3. Grpc + Kafka
---
В данном случае логин и пароль передаются в сообщениях Kafka (в сериализованном виде). Так как логин и пароль передаются в общедоступном формате, Kafka сохраняет эти сообщения
на неопределенный срок создается большая уязвимость безопасности. Не рекомендуем. 


### Proto
---
хранение proto контрактов в корне репозитория в папке shared/protos 

## Consequences
---
1. Для создания любого нового микросервиса используется шаблоны приведенные выше.  
2. Все микросервисы для сериализации/дисериализации сообщений используют proto контракты из папки shared/protos.