
# Авторизация.Начало.

## Status
---
Предложение

## Context
---
Необходимо реализовать авторизацию пользователя на бирже

## Decision
### Шаблоны микросервисов
---
Для создания авторизационного сервисa используем шаблон Calabonga.Microservice.IdentityModule.  
Для создания сервис-фасада используем шаблон Calabonga.Microservice.Module.  
Шаблоны используются для общей схемы всех микросервисов проекта.  
[Identity и простой шаблоны](https://github.com/Calabonga/Microservice-Template/tree/master/AspNetCore%20v6.0/MinimalAPI)

### Потребность в фасаде
---
Фасад нам необходим, потому что мы хотим иметь одну общую точку входа в приложение. Кроме того, фасад скрывает за собой остальную систему от пользователя. Дублирование endpoint'ов не является высокой ценой для подобного удобства


### Логика фасада
---
Пользователь делает запрос на endpoint фасада для получения авторизационного токена. Фасад передает логин и пароль авторизационному сервису,
получает токен и возвращает пользователю.

### Логика авторизационного сервиса
---
1. Авторизационный сервис получает от фасада логин и пароль пользователя, проверяет их с данными из бд. Если пользователь найден, то генерируется
токен и отправляется фасаду, иначе возвращается ошибка
2. Авторизационный сервис получает от фасада токен, проверяет его валидность и возвращает соответствующий статус

### Валидация токена
---
Валидация токена происходит на фасаде на уровне платформы. Таким образом остальным сервисам не надо заботиться об этом, а также если сервис авторизации упадет на некоторое время, то выданные им токены еще будут работать (до их срока истечения).
Токен будет передаваться в мета-данных grpc-запроса на фасад

### Общение фасада и авторизационного сервиса
---
Фасад и авторизационный сервис общаются по протоколу HTTP(S). Это сделано в целях использовать готовые решения для авторизации, которые уже реализованы
в шаблоне. Эти решения являются мировым стандартом, соотвественно использовать их выгоднее, чем писать свои реализации


### Синхронизация ответа от сервиса аутентификации/авторизации с методом и репликой фасада.
---
Для авторизации используется синхроныный HTTP(S) запрос. Таким образом пользователь должен дожидаться ответа с токеном. В данном случае это приемлемо, потому что пользователь не может ничего сделать без токена (без токена невозможно дальнейшее использование биржи)


## Consequences
---
1. Для создания любого нового микросервиса используется шаблоны приведенные выше.  
2. Авторизационный сервис становится особым сервисом, потому что общение с ним происходит через HTTP(S)
3. Дублирование endpoint'ов в фасаде
4. Быстрая реализация как базовых, так и дополнительных функций авторизации
5. Возможна значительная задержка по получению токена при высоких нагрузках
